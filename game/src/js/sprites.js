// Palette registry and sprite data (16x16 indexed pixels)
const Palette = {
  witch: {
    0: null,
    1: "#EA0707",
    2: "#980000",
    3: "#6B0000",
    4: "#330000",
    5: "#F19B07",

    6: "#66FFE3",
    7: "#F2DB5E",
    8: "#988B41",
    9: "#5A265E",
    10: "#492C0B",
    11: "#272736",
    12: "#3CA370"
  },

  wattk: {
    0: null,
    1: "#FFB570",
    2: "#F19B07",
    3: "#C27E08",
    4: "#8FDE5D",
    5: "#3CA370",
    6: "#3D6E70"
  },

  heart: {
    0: null,
    1: "#FFFFEBFF",
    2: "#FFB5B5FF",
    3: "#FF6B97FF",
    4: "#BD4882FF",
    5: "#80366BFF",
    6: "#5A265EFF",
    7: "#422445FF",
    8: "#B0305CFF",
    9: "#6B1C38FF"

  }
  ,
  potion: {
    0: null,
    1: "#FFFFEBFF",
    8: "#43434FFF",
    9: "#532F06FF",
    10: "#2C1B08FF"
  }
  ,
  star: {
    0: null,
    1: "#FFFFEBFF",
    2: "#8BC5FFFF",
    3: "#4DA6FFFF",
    4: "#4B5BABFF",
    5: "#473B78FF",
    6: "#322947FF",
    7: "#66FFE3FF",
  }
  ,
  ui: {
    0: null,
    1: '#7F55B1',
    2: '#9B7EBD',
    3: '#F49BAB',
    4: '#FFE1E0',
    5: '#F7CFD8',
    6: '#F4F8D3',
    7: '#A6D6D6',
    8: '#8E7DBE',
    9: "#FFB5B5",
    10: "#C5F3EA"
  }
};

const WitchSprite = {
  id: "witch.mushroom",
  size: 16,
  palette: "witch",
  pixels: [
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0],
    [1, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 5, 1, 0, 0, 0],
    [0, 0, 1, 1, 1, 4, 4, 4, 2, 2, 5, 5, 5, 1, 0, 0],
    [0, 0, 0, 0, 1, 4, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0],
    [0, 0, 0, 0, 1, 2, 2, 1, 1, 1, 8, 8, 8, 2, 1, 1],
    [0, 0, 1, 1, 1, 2, 1, 1, 8, 10, 10, 10, 8, 1, 1, 0],
    [0, 1, 1, 4, 1, 1, 1, 8, 8, 10, 12, 10, 8, 0, 0, 0],
    [1, 1, 1, 1, 1, 1, 8, 8, 10, 9, 10, 10, 0, 0, 0, 0],
    [0, 0, 0, 0, 8, 8, 8, 8, 10, 0, 8, 0, 0, 0, 0, 0],
    [0, 0, 0, 8, 8, 8, 8, 3, 3, 3, 8, 11, 11, 11, 0, 0],
    [0, 0, 0, 8, 8, 7, 7, 2, 10, 2, 0, 11, 12, 11, 0, 0],
    [0, 0, 8, 7, 7, 7, 7, 2, 10, 2, 0, 11, 11, 11, 0, 0],
    [0, 8, 7, 7, 7, 7, 4, 3, 10, 10, 10, 11, 0, 0, 0, 0],
    [8, 7, 7, 7, 7, 4, 4, 4, 4, 4, 0, 11, 0, 0, 0, 0],
    [7, 7, 7, 7, 4, 4, 4, 4, 4, 4, 0, 11, 0, 0, 0, 0],
    [7, 7, 7, 4, 4, 4, 4, 4, 4, 4, 0, 11, 0, 0, 0, 0]
  ]
};

const wattkSprite = {
  id: "wattk.basic",
  size: 16,
  palette: "wattk",
  pixels: [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 1, 3, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 1, 2, 3, 2, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 1, 1, 2, 2, 3, 2, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 1, 2, 6, 6, 4, 2, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 2, 6, 6, 6, 2, 0, 0, 0],
    [2, 2, 4, 2, 2, 6, 6, 2, 2, 5, 4, 2, 6, 2, 0, 0],
    [5, 5, 6, 6, 4, 6, 5, 5, 3, 3, 5, 5, 5, 4, 2, 0],
    [2, 6, 4, 2, 2, 2, 4, 3, 2, 4, 3, 4, 3, 3, 2, 2],
    [2, 2, 5, 4, 5, 3, 3, 2, 6, 5, 3, 5, 2, 3, 3, 0],
    [0, 0, 0, 0, 0, 0, 2, 6, 5, 5, 2, 4, 2, 0, 0, 0],
    [0, 0, 0, 0, 0, 2, 6, 6, 2, 2, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 2, 4, 3, 2, 2, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 3, 3, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]
};

const golemSprite = {
  id: "golem.basic",
  size: 16,
  palette: "stone",
  pixels: [
    [0, 0, 0, 17, 17, 17, 17, 17, 17, 17, 17, 17, 0, 0, 0, 0],
    [0, 0, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 17, 0, 0, 0],
    [0, 17, 18, 19, 19, 18, 18, 18, 18, 18, 19, 19, 18, 17, 0, 0],
    [0, 17, 18, 19, 18, 18, 17, 17, 17, 17, 18, 19, 18, 17, 0, 0],
    [17, 18, 18, 18, 18, 17, 17, 18, 18, 17, 17, 18, 18, 18, 17, 0],
    [17, 18, 18, 18, 17, 17, 18, 19, 19, 18, 17, 17, 18, 18, 17, 0],
    [17, 18, 18, 17, 17, 18, 19, 18, 18, 19, 18, 17, 17, 18, 17, 0],
    [0, 17, 17, 17, 18, 19, 18, 17, 17, 18, 19, 18, 17, 17, 0, 0],
    [0, 0, 17, 18, 18, 18, 17, 17, 17, 17, 18, 18, 18, 17, 0, 0],
    [0, 0, 17, 18, 18, 17, 17, 0, 0, 17, 17, 18, 18, 17, 0, 0],
    [0, 0, 0, 17, 17, 17, 0, 0, 0, 0, 17, 17, 17, 0, 0, 0],
    [0, 0, 0, 17, 18, 17, 0, 0, 0, 0, 17, 18, 17, 0, 0, 0],
    [0, 0, 0, 18, 18, 18, 0, 0, 0, 0, 18, 18, 18, 0, 0, 0],
    [0, 0, 0, 18, 19, 18, 0, 0, 0, 0, 18, 19, 18, 0, 0, 0],
    [0, 0, 0, 17, 17, 17, 0, 0, 0, 0, 17, 17, 17, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
  ]
};

const HeartSprite = {
  id: "ui.heart",
  size: 16,
  palette: "heart",
  pixels: [
    [0, 0, 0, 8, 8, 8, 0, 0, 0, 0, 8, 9, 8, 0, 0, 0],
    [0, 0, 8, 9, 9, 8, 8, 0, 0, 8, 9, 9, 9, 8, 0, 0],
    [0, 8, 8, 7, 7, 7, 8, 8, 8, 9, 7, 7, 9, 9, 8, 0],
    [8, 9, 7, 9, 7, 7, 7, 9, 8, 7, 7, 7, 6, 6, 8, 8],
    [8, 6, 9, 6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 6, 5, 8],
    [8, 5, 6, 6, 6, 5, 5, 5, 5, 5, 6, 5, 5, 1, 5, 8],
    [8, 5, 5, 5, 5, 4, 4, 5, 5, 6, 5, 6, 6, 1, 6, 8],
    [8, 4, 5, 5, 4, 4, 4, 4, 4, 4, 5, 4, 4, 1, 4, 8],
    [8, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 4, 5, 8],
    [0, 8, 3, 4, 4, 4, 3, 3, 4, 4, 4, 3, 1, 3, 8, 0],
    [0, 8, 3, 3, 3, 3, 3, 3, 3, 4, 4, 1, 4, 3, 8, 0],
    [0, 0, 8, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 8, 0, 0],
    [0, 0, 0, 8, 8, 2, 2, 2, 3, 3, 2, 8, 8, 0, 0, 0],
    [0, 0, 0, 0, 0, 8, 2, 2, 3, 2, 8, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 8, 2, 2, 8, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 8, 8, 0, 0, 0, 0, 0, 0, 0]
  ]
};

const StarSprite = {
  id: "ui.star",
  size: 16,
  palette: "star",
  pixels: [
    [0, 0, 0, 0, 0, 0, 0, 5, 5, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 5, 2, 2, 5, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 1, 5, 4, 2, 5, 1, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 5, 3, 4, 4, 2, 5, 0, 0, 0, 0, 0],
    [0, 5, 5, 5, 5, 2, 1, 1, 4, 2, 3, 5, 5, 5, 5, 0],
    [5, 2, 2, 2, 2, 4, 3, 4, 4, 4, 1, 2, 1, 2, 4, 5],
    [6, 4, 4, 1, 1, 3, 3, 4, 4, 2, 4, 1, 4, 2, 3, 6],
    [0, 6, 2, 4, 1, 1, 3, 3, 4, 2, 3, 4, 3, 3, 6, 0],
    [0, 0, 6, 3, 3, 4, 4, 4, 4, 3, 3, 3, 3, 6, 0, 0],
    [0, 0, 0, 6, 6, 2, 2, 4, 2, 2, 4, 6, 6, 0, 0, 0],
    [0, 0, 0, 0, 6, 4, 3, 3, 1, 4, 2, 6, 0, 0, 0, 0],
    [0, 0, 0, 6, 4, 2, 4, 3, 3, 4, 4, 2, 6, 0, 0, 0],
    [0, 0, 0, 6, 1, 4, 2, 6, 6, 2, 2, 4, 6, 0, 0, 0],
    [0, 0, 6, 2, 3, 4, 6, 0, 0, 6, 2, 4, 3, 6, 0, 0],
    [0, 1, 2, 4, 2, 6, 0, 0, 0, 0, 6, 3, 3, 2, 1, 0],
    [0, 6, 1, 6, 6, 0, 0, 0, 0, 0, 0, 6, 6, 4, 6, 0]
  ]
};

const ManaPotionSprite = {
  id: "ui.mana_potion",
  size: 16,
  palette: ["star", "potion"],
  pixels: [
    [0, 0, 0, 0, 0, 9, 9, 9, 9, 9, 9, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 9, 9, 9, 9, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 8, 8, 9, 9, 8, 8, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 8, 1, 1, 8, 0, 0, 0, 0, 0, 0],
    [0, 0, 10, 10, 10, 0, 8, 1, 1, 8, 0, 0, 0, 0, 0, 0],
    [0, 0, 10, 0, 10, 10, 8, 1, 1, 8, 0, 0, 0, 0, 0, 0],
    [0, 0, 10, 10, 10, 10, 10, 10, 10, 10, 10, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 8, 8, 1, 1, 8, 8, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 8, 1, 1, 1, 1, 1, 1, 8, 0, 0, 0, 0],
    [0, 0, 0, 8, 7, 3, 7, 7, 7, 7, 7, 7, 8, 0, 0, 0],
    [0, 0, 8, 7, 5, 3, 7, 7, 4, 7, 1, 3, 5, 8, 0, 0],
    [0, 8, 3, 3, 3, 3, 3, 3, 3, 7, 3, 1, 4, 4, 8, 0],
    [0, 8, 7, 7, 3, 4, 7, 7, 3, 3, 5, 1, 4, 4, 8, 0],
    [0, 8, 5, 4, 4, 3, 3, 5, 4, 4, 1, 4, 5, 5, 8, 0],
    [0, 0, 8, 5, 4, 4, 4, 4, 5, 5, 5, 5, 5, 8, 0, 0],
    [0, 0, 0, 8, 8, 8, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0]
  ]
};

const HealthPotionSprite = {
  id: "ui.health_potion",
  size: 16,
  palette: ["heart", "potion"],
  pixels: [
    [0, 0, 0, 0, 0, 9, 9, 9, 9, 9, 9, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 9, 9, 9, 9, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 8, 8, 9, 9, 8, 8, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 8, 1, 1, 8, 0, 0, 0, 0, 0, 0],
    [0, 0, 10, 10, 10, 0, 8, 1, 1, 8, 0, 0, 0, 0, 0, 0],
    [0, 0, 10, 0, 10, 10, 8, 1, 1, 8, 0, 0, 0, 0, 0, 0],
    [0, 0, 10, 10, 10, 10, 10, 10, 10, 10, 10, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 8, 8, 1, 1, 8, 8, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 8, 1, 1, 1, 1, 1, 1, 8, 0, 0, 0, 0],
    [0, 0, 0, 8, 7, 3, 7, 7, 7, 7, 7, 7, 8, 0, 0, 0],
    [0, 0, 8, 7, 5, 3, 7, 7, 4, 7, 1, 3, 5, 8, 0, 0],
    [0, 8, 3, 3, 3, 3, 3, 3, 3, 7, 3, 1, 4, 4, 8, 0],
    [0, 8, 7, 7, 3, 4, 7, 7, 3, 3, 5, 1, 4, 4, 8, 0],
    [0, 8, 5, 4, 4, 3, 3, 5, 4, 4, 1, 4, 5, 5, 8, 0],
    [0, 0, 8, 5, 4, 4, 4, 4, 5, 5, 5, 5, 5, 8, 0, 0],
    [0, 0, 0, 8, 8, 8, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0]
  ]
};

const wallSprite = {
  id: "tile.wall",
  size: 16,
  palette: "ui",
  pixels: [
    [1, 1, 2, 1, 1, 1, 6, 1, 1, 6, 1, 1, 1, 2, 1, 1],
    [1, 2, 5, 2, 1, 1, 1, 6, 6, 1, 1, 1, 2, 5, 2, 1],
    [2, 5, 2, 7, 5, 2, 2, 6, 6, 2, 2, 5, 7, 2, 5, 2],
    [1, 2, 7, 5, 2, 5, 6, 2, 2, 6, 5, 2, 5, 7, 2, 1],
    [1, 1, 5, 2, 5, 6, 7, 5, 5, 7, 6, 5, 2, 5, 1, 1],
    [1, 1, 2, 5, 6, 7, 5, 5, 5, 5, 7, 6, 5, 2, 1, 1],
    [6, 1, 2, 6, 7, 5, 7, 7, 7, 7, 5, 7, 6, 2, 1, 6],
    [1, 6, 6, 2, 5, 5, 7, 6, 6, 7, 5, 5, 2, 6, 6, 1],
    [1, 6, 6, 2, 5, 5, 7, 6, 6, 7, 5, 5, 2, 6, 6, 1],
    [6, 1, 2, 6, 7, 5, 7, 7, 7, 7, 5, 7, 6, 2, 1, 6],
    [1, 1, 2, 5, 6, 7, 5, 5, 5, 5, 7, 6, 5, 2, 1, 1],
    [1, 1, 5, 2, 5, 6, 7, 5, 5, 7, 6, 5, 2, 5, 1, 1],
    [1, 2, 7, 5, 2, 5, 6, 2, 2, 6, 5, 2, 5, 7, 2, 1],
    [2, 5, 2, 7, 5, 2, 2, 6, 6, 2, 2, 5, 7, 2, 5, 2],
    [1, 2, 5, 2, 1, 1, 1, 6, 6, 1, 1, 1, 2, 5, 2, 1],
    [1, 1, 2, 1, 1, 1, 6, 1, 1, 6, 1, 1, 1, 2, 1, 1],

  ]
};

const floorSprite = {
  id: "tile.floor",
  size: 16,
  palette: "ui",
  pixels: [
    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
    [3, 4, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 3],
    [3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3],
    [3, 3, 4, 3, 4, 4, 4, 4, 4, 4, 4, 4, 3, 4, 3, 3],
    [3, 3, 4, 4, 8, 8, 8, 9, 9, 8, 8, 8, 4, 4, 3, 3],
    [3, 3, 4, 4, 8, 10, 8, 9, 9, 8, 10, 8, 4, 4, 3, 3],
    [3, 3, 4, 4, 8, 8, 10, 10, 10, 10, 8, 8, 4, 4, 3, 3],
    [3, 3, 4, 4, 9, 9, 10, 9, 9, 10, 9, 9, 4, 4, 3, 3],
    [3, 3, 4, 4, 9, 9, 10, 9, 9, 10, 9, 9, 4, 4, 3, 3],
    [3, 3, 4, 4, 8, 8, 10, 10, 10, 10, 8, 8, 4, 4, 3, 3],
    [3, 3, 4, 4, 8, 10, 8, 9, 9, 8, 10, 8, 4, 4, 3, 3],
    [3, 3, 4, 4, 8, 8, 8, 9, 9, 8, 8, 8, 4, 4, 3, 3],
    [3, 3, 4, 3, 4, 4, 4, 4, 4, 4, 4, 4, 3, 4, 3, 3],
    [3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3],
    [3, 4, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 3],
    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
  ]
};

class SpriteAPI {
  constructor(ctx, scale = 1) {
    this.ctx = ctx;
    this.scale = scale;
  }

  draw(sprite, x, y, flip = false) {
    const px = sprite.pixels;
    const size = sprite.size || 16;

    // allow sprite.palette to be a string (single palette) or an array of palette names
    let paletteList = [];
    if (Array.isArray(sprite.palette)) {
      paletteList = sprite.palette.map(name => Palette[name] || {});
    } else {
      paletteList = [Palette[sprite.palette] || {}];
    }

    for (let y0 = 0; y0 < size; y0++) {
      for (let x0 = 0; x0 < size; x0++) {
        const sx = flip ? (size - 1 - x0) : x0;
        const idx = px[y0][sx];
        let color = null;
        for (let pi = 0; pi < paletteList.length; pi++) {
          const pmap = paletteList[pi];
          if (pmap && (idx in pmap) && pmap[idx]) { color = pmap[idx]; break; }
        }
        if (!color) continue;
        this.ctx.fillStyle = color;
        this.ctx.fillRect(
          x + x0 * this.scale,
          y + y0 * this.scale,
          this.scale,
          this.scale
        );
      }
    }
  }
}

// expose on window for easy access from other modules
window.Palette = Palette;
window.WitchSprite = WitchSprite;
window.SpriteAPI = SpriteAPI;
// expose floor and wall tiles as well
if (typeof wallSprite !== 'undefined') window.wallSprite = wallSprite;
if (typeof floorSprite !== 'undefined') window.floorSprite = floorSprite;
// expose UI icons
if (typeof HeartSprite !== 'undefined') window.HeartSprite = HeartSprite;
if (typeof StarSprite !== 'undefined') window.StarSprite = StarSprite;
if (typeof ManaPotionSprite !== 'undefined') window.ManaPotionSprite = ManaPotionSprite;
if (typeof HealthPotionSprite !== 'undefined') window.HealthPotionSprite = HealthPotionSprite;
// expose enemies
if (typeof golemSprite !== 'undefined') window.golemSprite = golemSprite;
if (typeof wattkSprite !== 'undefined') window.wattkSprite = wattkSprite;

// placeholder key sprite (simple indexed 16x16 using ui palette)
const KeySprite = {
  id: 'item.key',
  size: 16,
  palette: 'ui',
  pixels: [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 3, 3, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 3, 3, 2, 2, 3, 3, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 3, 3, 2, 1, 1, 2, 3, 3, 0, 0, 0, 0],
    [0, 0, 0, 3, 3, 2, 1, 1, 1, 1, 2, 3, 3, 0, 0, 0],
    [0, 0, 3, 3, 2, 1, 1, 1, 1, 1, 1, 2, 3, 3, 0, 0],
    [0, 3, 3, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 3, 3, 0],
    [0, 0, 0, 3, 3, 2, 1, 1, 1, 1, 2, 3, 3, 0, 0, 0],
    [0, 0, 0, 0, 0, 3, 3, 2, 2, 3, 3, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 3, 3, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
  ]
};
window.KeySprite = KeySprite;